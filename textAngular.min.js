<<<<<<< HEAD
if(!window.console)console={log:function(){}};var textAngular=angular.module("textAngular",["ngSanitize"]);textAngular.directive("textAngular",["$compile","$window","$document","$rootScope","$timeout",function(t,e,a,n,l){console.log("Thank you for using textAngular! http://www.textangular.com");function i(t,e){for(var a in e){if(e[a]&&e[a].constructor&&e[a].constructor===Object){t[a]=t[a]||{};arguments.callee(t[a],e[a])}else{t[a]=e[a]}}return t}n.textAngularOpts=i({toolbar:[["h1","h2","h3","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight"],["html","insertImage","insertLink","unlink"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",textEditor:"form-control",htmlEditor:"form-control"}},n.textAngularOpts!=null?n.textAngularOpts:{});var o=function(t){t=t.toLowerCase();var e=a[0].queryCommandValue("formatBlock").toLowerCase();return e===t||e===t};n.textAngularTools=i({html:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>Toggle HTML</button>",action:function(){var t,e=this;this.$parent.showHtml=!this.$parent.showHtml;if(this.$parent.showHtml){l(function(){return e.$parent.displayElements.html[0].focus()},100)}else{l(function(){return e.$parent.displayElements.text[0].focus()},100)}this.active=this.$parent.showHtml}},h1:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H1</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H1>")},activeState:function(){return o("h1")}},h2:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H2</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H2>")},activeState:function(){return o("h2")}},h3:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H3</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H3>")},activeState:function(){return o("h3")}},p:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>P</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<P>")},activeState:function(){return o("p")}},pre:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>pre</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<PRE>")},activeState:function(){return o("pre")}},ul:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-list-ul'></i></button>",action:function(){return this.$parent.wrapSelection("insertUnorderedList",null)},activeState:function(){return a[0].queryCommandState("insertUnorderedList")}},ol:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-list-ol'></i></button>",action:function(){return this.$parent.wrapSelection("insertOrderedList",null)},activeState:function(){return a[0].queryCommandState("insertOrderedList")}},quote:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-quote-right'></i></button>",action:function(){return this.$parent.wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return o("blockquote")}},undo:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-undo'></i></button>",action:function(){return this.$parent.wrapSelection("undo",null)}},redo:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-repeat'></i></button>",action:function(){return this.$parent.wrapSelection("redo",null)}},bold:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-bold'></i></button>",action:function(){return this.$parent.wrapSelection("bold",null)},activeState:function(){return a[0].queryCommandState("bold")}},justifyLeft:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-left'></i></button>",action:function(){return this.$parent.wrapSelection("justifyLeft",null)},activeState:function(){return a[0].queryCommandState("justifyLeft")}},justifyRight:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-right'></i></button>",action:function(){return this.$parent.wrapSelection("justifyRight",null)},activeState:function(){return a[0].queryCommandState("justifyRight")}},justifyCenter:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-center'></i></button>",action:function(){return this.$parent.wrapSelection("justifyCenter",null)},activeState:function(){return a[0].queryCommandState("justifyCenter")}},italics:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-italic'></i></button>",action:function(){return this.$parent.wrapSelection("italic",null)},activeState:function(){return a[0].queryCommandState("italic")}},underline:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-underline'></i></button>",action:function(){return this.$parent.wrapSelection("underline",null)},activeState:function(){return a[0].queryCommandState("underline")}},clear:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-ban'></i></button>",action:function(){return this.$parent.wrapSelection("removeFormat",null)}},insertImage:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-picture-o'></i></button>",action:function(){var t;t=prompt("Please enter an image URL to insert","http://");if(t!==""){return this.$parent.wrapSelection("insertImage",t)}}},insertLink:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-link'></i></button>",action:function(){var t;t=prompt("Please enter an URL to insert","http://");if(t!==""){return this.$parent.wrapSelection("createLink",t)}}},unlink:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-unlink'></i></button>",action:function(){return this.$parent.wrapSelection("unlink",null)}}},n.textAngularTools!=null?n.textAngularTools:{});return{require:"?ngModel",scope:{},restrict:"EA",link:function(e,i,o,s){var r,c,u,d,p,f;angular.extend(e,n.textAngularOpts,{wrapSelection:function(t,a){document.execCommand(t,false,a);if(e.showHtml)e.displayElements.html[0].focus();else e.displayElements.text[0].focus();e.updateSelectedStyles();if(!e.showHtml)e.updateTaBindtext()},showHtml:false});if(!!o.taToolbar)e.toolbar=e.$eval(o.taToolbar);if(!!o.taFocussedClass)e.classes.focussed=e.$eval(o.taFocussedClass);if(!!o.taToolbarClass)e.classes.toolbar=o.taToolbarClass;if(!!o.taToolbarGroupClass)e.classes.toolbarGroup=o.taToolbarGroupClass;if(!!o.taToolbarButtonClass)e.classes.toolbarButton=o.taToolbarButtonClass;if(!!o.taToolbarActiveButtonClass)e.classes.toolbarButtonActive=o.taToolbarActiveButtonClass;if(!!o.taTextEditorClass)e.classes.textEditor=o.taTextEditorClass;if(!!o.taHtmlEditorClass)e.classes.htmlEditor=o.taHtmlEditorClass;var m=i.html();i.html("");e.displayElements={toolbar:angular.element("<div></div>"),forminput:angular.element("<input type='hidden' style='display: none;'>"),html:angular.element("<textarea ng-show='showHtml' ta-bind='html' ng-model='html' ></textarea>"),text:angular.element("<div contentEditable='true' ng-hide='showHtml' ta-bind='text' ng-model='text' ></div>")};i.append(e.displayElements.toolbar);i.append(e.displayElements.text);i.append(e.displayElements.html);if(!!o.name){e.displayElements.forminput.attr("name",o.name);i.append(e.displayElements.forminput)}if(!!o.taDisabled){e.displayElements.text.attr("ta-readonly","disabled");e.displayElements.html.attr("ta-readonly","disabled");e.disabled=e.$parent.$eval(o.taDisabled);e.$parent.$watch(o.taDisabled,function(t){e.disabled=t;if(e.disabled){i.addClass("disabled")}else{i.removeClass("disabled")}})}t(e.displayElements.text)(e);t(e.displayElements.html)(e);i.addClass("ta-root");e.displayElements.toolbar.addClass("ta-toolbar "+e.classes.toolbar);e.displayElements.text.addClass("ta-text ta-editor "+e.classes.textEditor);e.displayElements.html.addClass("ta-html ta-editor "+e.classes.textEditor);i.on("focusin",function(){i.addClass(e.classes.focussed);l(function(){i.triggerHandler("focus")},0)});i.on("focusout",function(){l(function(){if(!(a[0].activeElement===e.displayElements.html[0])&&!(a[0].activeElement===e.displayElements.text[0])){i.removeClass(e.classes.focussed);l(function(){i.triggerHandler("blur")},0)}},0)});e.tools={};for(var y=0;y<e.toolbar.length;y++){r=e.toolbar[y];c=angular.element("<div></div>");c.addClass(e.classes.toolbarGroup);for(var b=0;b<r.length;b++){p=r[b];f=angular.element(n.textAngularTools[p].display);f.addClass(e.classes.toolbarButton);f.attr("unselectable","on");f.attr("ng-disabled","showHtml()");var g=angular.extend(e.$new(true),n.textAngularTools[p],{name:p,showHtml:function(){if(this.name!=="html")return this.$parent.disabled||this.$parent.showHtml;return this.$parent.disabled},displayActiveToolClass:function(t){return t?this.$parent.classes.toolbarButtonActive:""}});e.tools[p]=g;c.append(t(f)(g))}e.displayElements.toolbar.append(c)}if(o.ngModel){s.$render=function(){e.displayElements.forminput.val(s.$viewValue);if(!(a[0].activeElement===e.displayElements.html[0])&&!(a[0].activeElement===e.displayElements.text[0])){var t=s.$viewValue||"";e.text=t;e.html=t}}}else{e.displayElements.forminput.val(m);e.text=m;e.html=m}e.$watch("text",function(t,a){e.html=t;if(o.ngModel&&t!==a)s.$setViewValue(t);e.displayElements.forminput.val(t)});e.$watch("html",function(t,a){e.text=t;if(o.ngModel&&t!==a)s.$setViewValue(t);e.displayElements.forminput.val(t)});e.bUpdateSelectedStyles=false;e.updateSelectedStyles=function(){for(var t=0;t<e.toolbar.length;t++){var a=e.toolbar[t];for(var n=0;n<a.length;n++){p=a[n];if(e.tools[p].activeState!=null){e.tools[p].active=e.tools[p].activeState.apply(e)}}}if(this.bUpdateSelectedStyles)l(this.updateSelectedStyles,200)};u=function(t){e.bUpdateSelectedStyles=true;e.$apply(function(){e.updateSelectedStyles()})};e.displayElements.html.on("keydown",u);e.displayElements.text.on("keydown",u);d=function(t){e.bUpdateSelectedStyles=false};e.displayElements.html.on("keyup",d);e.displayElements.text.on("keyup",d);mouseup=function(t){e.$apply(function(){e.updateSelectedStyles()})};e.displayElements.html.on("mouseup",mouseup);e.displayElements.text.on("mouseup",mouseup)}}}]).directive("taBind",["$sanitize","$document","taFixChrome",function(t,e,a){return{require:"ngModel",scope:{taBind:"@"},link:function(n,l,i,o){var s=l[0].tagName.toLowerCase()!=="textarea"&&l[0].tagName.toLowerCase()!=="input"&&l.attr("contenteditable")!==undefined&&l.attr("contenteditable");var r=false;var c=function(){var t=a(l).html();if(n.taBind==="html"&&s)t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");return t};n.$parent["updateTaBind"+n.taBind]=function(){var t=c();var e=o.$parsers;o.$parsers=[];o.$oldViewValue=t;o.$setViewValue(t);o.$parsers=e};if(s){l.on("keyup",function(t){if(!r)o.$setViewValue(c())})}o.$parsers.push(function(e){if(o.$oldViewValue===undefined)o.$oldViewValue=e;try{t(e)}catch(a){return o.$oldViewValue}o.$oldViewValue=e;return e});o.$render=function(){if(e[0].activeElement!==l[0]){var t=o.$viewValue||"";o.$oldViewValue=t;if(n.taBind==="text"){try{angular.element(t).find("script").remove()}catch(a){}l.html(t);l.find("a").on("click",function(t){t.preventDefault();return false})}else if(s||l[0].tagName.toLowerCase()!=="textarea"&&l[0].tagName.toLowerCase()!=="input")l.html(t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"));else l.val(t)}else if(!s)l.val(t)};if(!!i.taReadonly){if(n.$parent.$eval(i.taReadonly)){if(l[0].tagName.toLowerCase()==="textarea"||l[0].tagName.toLowerCase()==="input")l.attr("disabled","disabled");if(l.attr("contenteditable")!==undefined&&l.attr("contenteditable"))l.removeAttr("contenteditable")}else{if(l[0].tagName.toLowerCase()==="textarea"||l[0].tagName.toLowerCase()==="input")l.removeAttr("disabled");else if(s)l.attr("contenteditable","true")}n.$parent.$watch(i.taReadonly,function(t,e){if(e===t)return;if(t){if(l[0].tagName.toLowerCase()==="textarea"||l[0].tagName.toLowerCase()==="input")l.attr("disabled","disabled");if(l.attr("contenteditable")!==undefined&&l.attr("contenteditable"))l.removeAttr("contenteditable")}else{if(l[0].tagName.toLowerCase()==="textarea"||l[0].tagName.toLowerCase()==="input")l.removeAttr("disabled");else if(s)l.attr("contenteditable","true")}r=t})}}}}]).factory("taFixChrome",function(){var t=function(t){var e=angular.element(t).find("span");for(var a=0;a<e.length;a++){var n=angular.element(e[a]);if(n.attr("style")&&n.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)){if(n.next().length>0&&n.next()[0].tagName==="BR")n.next().remove();n.replaceWith(n.html())}}var l=t.html().replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/gi,"");if(l!==t.html())t.html(l);return t};return t});
=======
var textAngular=angular.module("textAngular",["ngSanitize"]);textAngular.directive("textAngular",["$compile","$window","$document","$rootScope","$timeout","taFixChrome",function(t,e,n,a,l,i){console.log("Thank you for using textAngular! http://www.textangular.com");function o(t,e){for(var n in e){if(e[n]&&e[n].constructor&&e[n].constructor===Object){t[n]=t[n]||{};arguments.callee(t[n],e[n])}else{t[n]=e[n]}}return t}a.textAngularOpts=o({toolbar:[["h1","h2","h3","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight"],["html","insertImage","insertLink","unlink"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",textEditor:"form-control",htmlEditor:"form-control"},icons:{ul:"fa fa-list-ul",ol:"fa fa-list-ol",quote:"fa fa-quote-right",undo:"fa fa-undo",redo:"fa fa-repeat",bold:"fa fa-bold",justifyLeft:"fa fa-align-left",justifyRight:"fa fa-align-right",justifyCenter:"fa fa-align-center",italics:"fa fa-italic",underline:"fa fa-underline",clear:"fa fa-ban",insertImage:"fa fa-picture-o",insertLink:"fa fa-chain",unlink:"fa fa-unlink"}},a.textAngularOpts!=null?a.textAngularOpts:{});var s=function(t){t=t.toLowerCase();var e=n[0].queryCommandValue("formatBlock").toLowerCase();return e===t||e===t};a.textAngularTools=o({html:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>Toggle HTML</button>",action:function(){var t,e=this;this.$parent.showHtml=!this.$parent.showHtml;if(this.$parent.showHtml){l(function(){return e.$parent.displayElements.html[0].focus()},100)}else{l(function(){return e.$parent.displayElements.text[0].focus()},100)}this.active=this.$parent.showHtml}},h1:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H1</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H1>")},activeState:function(){return s("h1")}},h2:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H2</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H2>")},activeState:function(){return s("h2")}},h3:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H3</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H3>")},activeState:function(){return s("h3")}},p:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>P</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<P>")},activeState:function(){return s("p")}},pre:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>pre</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<PRE>")},activeState:function(){return s("pre")}},ul:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){return this.$parent.wrapSelection("insertUnorderedList",null)},activeState:function(){return n[0].queryCommandState("insertUnorderedList")}},ol:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){return this.$parent.wrapSelection("insertOrderedList",null)},activeState:function(){return n[0].queryCommandState("insertOrderedList")}},quote:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){return this.$parent.wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return s("blockquote")}},undo:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){return this.$parent.wrapSelection("undo",null)}},redo:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){return this.$parent.wrapSelection("redo",null)}},bold:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){return this.$parent.wrapSelection("bold",null)},activeState:function(){return n[0].queryCommandState("bold")}},justifyLeft:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){return this.$parent.wrapSelection("justifyLeft",null)},activeState:function(){return n[0].queryCommandState("justifyLeft")}},justifyRight:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){return this.$parent.wrapSelection("justifyRight",null)},activeState:function(){return n[0].queryCommandState("justifyRight")}},justifyCenter:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){return this.$parent.wrapSelection("justifyCenter",null)},activeState:function(){return n[0].queryCommandState("justifyCenter")}},italics:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){return this.$parent.wrapSelection("italic",null)},activeState:function(){return n[0].queryCommandState("italic")}},underline:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){return this.$parent.wrapSelection("underline",null)},activeState:function(){return n[0].queryCommandState("underline")}},clear:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){return this.$parent.wrapSelection("removeFormat",null)}},insertImage:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){var t;t=prompt("Please enter an image URL to insert","http://");if(t!==""){return this.$parent.wrapSelection("insertImage",t)}}},insertLink:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){var t;t=prompt("Please enter an URL to insert","http://");if(t!==""){return this.$parent.wrapSelection("createLink",t)}}},unlink:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'></button>",action:function(){return this.$parent.wrapSelection("unlink",null)}}},a.textAngularTools!=null?a.textAngularTools:{});return{require:"ngModel",scope:{},restrict:"EA",link:function(e,o,s,r){var u,c,p,d,f,m;angular.extend(e,a.textAngularOpts,{wrapSelection:function(t,n){document.execCommand(t,false,n);if(t==="insertUnorderedList"||t==="insertOrderedList")i(e.displayElements.text);if(e.showHtml)e.displayElements.html[0].focus();else e.displayElements.text[0].focus();e.updateSelectedStyles();if(!e.showHtml)e.updateTaBindtext()},showHtml:false});if(!!s.taToolbar)e.toolbar=e.$eval(s.taToolbar);if(!!s.taFocussedClass)e.classes.focussed=e.$eval(s.taFocussedClass);if(!!s.taToolbarClass)e.classes.toolbar=s.taToolbarClass;if(!!s.taToolbarGroupClass)e.classes.toolbarGroup=s.taToolbarGroupClass;if(!!s.taToolbarButtonClass)e.classes.toolbarButton=s.taToolbarButtonClass;if(!!s.taToolbarActiveButtonClass)e.classes.toolbarButtonActive=s.taToolbarActiveButtonClass;if(!!s.taTextEditorClass)e.classes.textEditor=s.taTextEditorClass;if(!!s.taHtmlEditorClass)e.classes.htmlEditor=s.taHtmlEditorClass;e.displayElements={toolbar:angular.element("<div></div>"),forminput:angular.element("<input type='hidden' style='display: none;'>"),html:angular.element("<textarea ng-show='showHtml' ta-bind='html' ng-model='html' ></textarea>"),text:angular.element("<div contentEditable='true' ng-hide='showHtml' ta-bind='text' ng-model='text' ></div>")};o.append(e.displayElements.toolbar);o.append(e.displayElements.text);o.append(e.displayElements.html);if(!!s.name){e.displayElements.forminput.attr("name",s.name);o.append(e.displayElements.forminput)}t(e.displayElements.text)(e);t(e.displayElements.html)(e);o.addClass("ta-root");e.displayElements.toolbar.addClass("ta-toolbar "+e.classes.toolbar);e.displayElements.text.addClass("ta-text ta-editor "+e.classes.textEditor);e.displayElements.html.addClass("ta-html ta-editor "+e.classes.textEditor);o.on("focusin",function(){o.addClass(e.classes.focussed);l(function(){o.triggerHandler("focus")},0)});o.on("focusout",function(){l(function(){if(!(n[0].activeElement===e.displayElements.html[0])&&!(n[0].activeElement===e.displayElements.text[0])){o.removeClass(e.classes.focussed);l(function(){o.triggerHandler("blur")},0)}},0)});e.tools={};e.buildTools=function(){for(var n=0;n<e.toolbar.length;n++){u=e.toolbar[n];c=angular.element("<div></div>");c.addClass(e.classes.toolbarGroup);for(var l=0;l<u.length;l++){f=u[l];m=angular.element(a.textAngularTools[f].display);m.addClass(e.classes.toolbarButton);m.attr("unselectable","on");m.attr("ng-disabled","showHtml()");if(!!e.icons[f]){m.append("<i class='"+e.icons[f]+"'></i>")}var i=angular.extend(e.$new(true),a.textAngularTools[f],{name:f,showHtml:function(){if(this.name!=="html")return this.$parent.showHtml;return false},displayActiveToolClass:function(t){return t?this.$parent.classes.toolbarButtonActive:""}});e.tools[f]=i;c.append(t(m)(i))}e.displayElements.toolbar.append(c)}};e.buildTools();e.$on("tools:rebuild",function(){e.displayElements.toolbar.empty();e.buildTools()});r.$render=function(){e.displayElements.forminput.val(r.$viewValue);if(r.$viewValue===undefined)return;if(!(n[0].activeElement===e.displayElements.html[0])&&!(n[0].activeElement===e.displayElements.text[0])){var t=r.$viewValue||"";e.text=t;e.html=t}};e.$watch("text",function(t,n){e.html=t;r.$setViewValue(t);e.displayElements.forminput.val(t)});e.$watch("html",function(t,n){e.text=t;r.$setViewValue(t);e.displayElements.forminput.val(t)});e.bUpdateSelectedStyles=false;e.updateSelectedStyles=function(){for(var t=0;t<e.toolbar.length;t++){var n=e.toolbar[t];for(var a=0;a<n.length;a++){f=n[a];if(e.tools[f].activeState!=null){e.tools[f].active=e.tools[f].activeState.apply(e)}}}if(this.bUpdateSelectedStyles)l(this.updateSelectedStyles,200)};p=function(t){e.bUpdateSelectedStyles=true;e.$apply(function(){e.updateSelectedStyles()})};e.displayElements.html.on("keydown",p);e.displayElements.text.on("keydown",p);d=function(t){e.bUpdateSelectedStyles=false};e.displayElements.html.on("keyup",d);e.displayElements.text.on("keyup",d);mouseup=function(t){e.$apply(function(){e.updateSelectedStyles()})};e.displayElements.html.on("mouseup",mouseup);e.displayElements.text.on("mouseup",mouseup)}}}]).directive("taBind",["$sanitize","$document","taFixChrome",function(t,e,n){return{require:"ngModel",scope:{taBind:"@"},link:function(a,l,i,o){var s=l[0].tagName.toLowerCase()!=="textarea"&&l[0].tagName.toLowerCase()!=="input"&&l.attr("contenteditable")!==undefined;var r=function(){var t=n(angular.element("<div>").append(l.html())).html();if(a.taBind==="html"&&s)t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");return t};a.$parent["updateTaBind"+a.taBind]=function(){var t=r();var e=o.$parsers;o.$parsers=[];o.$oldViewValue=t;o.$setViewValue(t);o.$parsers=e};if(s){l.on("keyup",function(t){o.$setViewValue(r())})}o.$parsers.push(function(e){if(o.$oldViewValue===undefined)o.$oldViewValue=e;try{t(e)}catch(n){return o.$oldViewValue}o.$oldViewValue=e;return e});o.$render=function(){if(o.$viewValue===undefined)return;if(e[0].activeElement!==l[0]){var t=o.$viewValue||"";o.$oldViewValue=t;if(a.taBind=="text"){l.html(t);l.find("a").on("click",function(t){t.preventDefault();return false})}else if(s||l[0].tagName.toLowerCase()!=="textarea"&&l[0].tagName.toLowerCase()!=="input")l.html(t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"));else l.val(t)}else if(!s)l.val(t)}}}}]).factory("taFixChrome",function(){var t=function(t){var e=angular.element(t).find("span");for(var n=0;n<e.length;n++){var a=angular.element(e[n]);if(a.attr("style")&&a.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)){if(a.next().length>0&&a.next()[0].tagName==="BR")a.next().remove();a.replaceWith(a.html())}}var l=t.html().replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/gi,"");t.html(l);return t};return t});
>>>>>>> 2dba656710317eee1f67d9ce962ddbf54bdb906e
